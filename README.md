# Trapyojo ロリ子 Bot ファンアーカイブ 草案 v1  
（参照用・仕様ドキュメント）

---

## 0. プロジェクト概要

### サイトの目的
- Trapyojo ロリ子 bot の面白いツイート・リプライをアーカイブする。
- ロリ子が好きな人たちがログを眺めて Slack 的スタンプでリアクションできるようにする。
- あくまで身内向けファンサイトだが、Laravel + Nuxt のポートフォリオとしても成立させる。

### 技術スタック
- フロント: Nuxt（SSR/SSG, Vue 3）
- バックエンド: Laravel（API サーバー＋管理画面）
- DB: MySQL または PostgreSQL

---

## 1. 方針・割り切り

### ユーザー体験（UX）
- 完全匿名・ログイン不要。
- ログ詳細や一覧から、Slack 的な「スタンプ（リアクション）」を押せる。
- リアクションは「運営側が定義した種類のみ」（ユーザー自由入力なし）。
- リアクション押し放題（連打OK）。ユーザーを特定しない。
- 「自分が押したかどうか」は localStorage で保持する程度に留める（ブラウザ消したら消える）。

### 安全性・運用制御
- スタンプは運営側ホワイトリストのみで、自由入力は不可。
- 管理機能は Laravel側の `/admin` で実装し、Breeze/Sanctum で認証する。
- 公開 API は読み取り + リアクション加算のみ。

### データの割り切り
- 誰が押したか（viewer 単位）は保存しない。
- サーバー側は「ログ × リアクション種類の集計」だけ持つ。
- 将来必要ならイベントテーブル（個別リアクションログ）を追加できる設計にする。

---

## 2. ドメインモデリング（概念整理）

### 主な概念（エンティティ）
1. **Log（ログ）**  
   ロリ子の1発言（ツイート）。
2. **ReactionType（リアクション種類）**  
   押せるスタンプの種類（❤️ / w / 😱 など）。
3. **ReactionCounter（集計）**  
   ログ × リアクション種類ごとのカウント値。
4. **Tag（タグ）**  
   罵倒・かわいい・哲学などの付加情報。
5. **AdminUser（管理者）**  
   ログ登録・編集・削除を行うユーザー。

---

## 3. 各エンティティ概要

### 3.1 Log
- 発言本文 `text`
- 元ツイートの URL `source_url`
- 元ツイート ID `source_tweet_id`
- 投稿日時 `posted_at`
- 過激表現フラグ `is_explicit`
- 複数タグとの多対多

### 3.2 ReactionType
- `code`（例: like / kusa / shock）
- `emoji`（表示用: ❤️, w, 😱）
- `label`（UI テキスト）
- 運営側が固定で定義するホワイトリスト

### 3.3 ReactionCounter
- `log_id` + `reaction_type_id` の組み合わせで一意
- `count` に集計値

### 3.4 Tag
- `slug`（URL用）
- `name`（表示名）
- `log_tag` 中間テーブルで Log と多対多

### 3.5 AdminUser
- 認証あり（Breeze など）
- 公開領域とは完全に分離して運用する

---

## 4. リアクション仕様（Slack風）

### UX
- 各ログの下に複数のスタンプを並べる。
- 押したら count が増え UI に反映。
- 複数種類同時に押せる。
- 連打もできる（仕様）。不正気味な連打も「身内ノリ」で許容する。

### 安全対策
- スタンプ種類は ReactionType テーブルに固定登録したもののみ。
- ユーザー任意の文字・画像を受け付けない。
- 公序良俗系は運営側判断で追加/削除可能。

### DB 方針
- `reaction_types`: スタンプ種類のマスタ
- `reaction_counters`: ログごとのリアクション集計
- 将来「誰が押したか」を管理したくなったら `reactions` イベントテーブルを追加すれば良い

---

## 5. API 方針

### GET `/api/logs`
- ログ一覧
- クエリ:
  - `page`, `per_page`
  - `tag`
  - `sort=recent|popular`
  - `q`（キーワード検索）
  - `safe_mode=1`（過激表現非表示）
- 各ログに `reactions[]` と `tags[]` を含めて返す。

### GET `/api/logs/{id}`
- ログ詳細
- 発言本文、元ツイート、リアクション一覧、タグを返す

### GET `/api/reaction-types`
- 利用可能なスタンプ一覧

### POST `/api/logs/{id}/reactions`
- 指定ログの指定スタンプを +1
- リクエスト例:
  ```json
  { "type": "kusa" }
  ```
- レスポンス:
  ```json
  { "log_id": 123, "type": "kusa", "count": 315 }
  ```

### 管理者系 API（要認証）

/api/admin/logs（作成・編集・削除）

/api/admin/tags（作成・編集・削除）

## 6. Day1 の機能境界（MVP）

### 6.1 実装する機能

トップページでランダムなロリ子名言を表示

/logs の一覧表示（新着順・人気順）

/logs/{id} の詳細表示

Slack的リアクション（like/kusa/shock/respect）

お上品モード（非表示）

API: ログ一覧, 詳細, 反応追加

初期データ: 手動で10〜20件登録

### 6.2 Day1 ではやらない（後回し）

会話スレッド表示

X の「いいね数」でランキング

ユーザーからのログ追加リクエストワークフロー

高度検索（全文検索エンジン）
しっかりした管理画面（必要最小限でOK）

## 7. 設計の目的（ドメインモデリングの意義）

DB や API 実装前に概念・関係を明文化し、迷いを減らすため。
仕様変更が来た時に、前提となる考え方に戻れる。
面接において「簡単な案件でも設計レイヤを踏んでいる」ことを説明しやすい。
